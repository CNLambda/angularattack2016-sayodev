{"version":3,"file":"chat.component.js","sourceRoot":"","sources":["chat.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';\nimport { SessionService } from '../session.service';\n\n@Component({\n  moduleId: module.id,\n  selector: 'chat',\n  templateUrl: 'chat.component.html',\n  styleUrls: ['chat.component.css']\n})\nexport class ChatComponent implements OnInit {\n\n    @Output() close_chat: EventEmitter<void>;\n    \n    public current_msg: string;\n    public username: string;\n    public id:string = \"\";\n    public messages: any[] = []; // {mine: bool, username: str, message: str}\n    public ws: WebSocket;\n\n    constructor(private session: SessionService) {\n        this.close_chat = new EventEmitter<void>();\n    }\n    get_id(x: string) : string {\n        let x2: string[] = x.split(\"/\");\n        if (x2[x2.length - 1] == \"\") {\n            return x2[x2.length - 2];\n        } else {\n            return x2[x2.length - 1];\n        }\n    }\n    ngOnInit() {\n        this.username = this.session.getBoardUsername(this.get_id(window.location.href));\n        this.id = this.get_id(window.location.href);\n        var ws = new WebSocket(\"wss://angularattack2016-sayodev.herokuapp.com/message\");\n        this.ws = ws;\n        \n        var this_component = this;\n        \n        ws.onopen = function () {\n              ws.send(JSON.stringify({\"username\": this_component.username, \"message\": \"I'm now online.\", \"board_id\": this_component.id, \"join\": \"true\"})); \n        };\n\n        // Log errors\n        ws.onerror = function (error) {\n          console.log('WebSocket Error ' + error);\n        };\n        \n        ws.onmessage = function (event) {\n            console.log(event);\n            var data = JSON.parse(event.data);\n            if(data.from == undefined) {\n                data.from = data.username;\n            }\n            if(data.from == this_component.username){\n                data.mine = true;\n            }else {\n                data.mine = false;\n            }\n            console.log(data);\n            this_component.messages.push(data);\n        };\n        ws.onclose = function() {\n            ws.send(JSON.stringify({\"from\": this_component.username, \"message\": \"I'm is going offline.\", \"board_id\": this_component.id}));\n        }\n        \n\n    }\n    \n    send() {\n        this.ws.send(JSON.stringify({'from': this.username, 'message': this.current_msg, \"board_id\": this.id}));\n        this.current_msg='';\n    }\n    \n    check_send(key) {\n        if (key == 13) {\n            this.send();\n        }\n    }\n\n}\n"]}